# onlineChat西二考核作业（前端部分）

> 林沧海（前端）     林炜（后端）

## 概述

#### 框架，插件，依赖

使用vue框架，使用 <u>vue-cli</u>；

插件：element

依赖：axios, **v-emoji-picker**, **vue-socket.io**, **vuescroll**, vue-router, **vuex**, **less**

编译器：vscode和webstorm混用

## 页面布局

#### 主页

主页为打开网页后最开始显示的界面，包含3个部分，分别为

* 创建新房间：创建一个房间（不会马上进入，会显示再已加入的房间里）

* 加入房间：输入房间号和邀请码进入房间

* 已加入的房间：显示所有已经加入过的房间

  > 具体判断：根据存在localStorage里面的token来判断

#### 组件

以下部分是组件：

* 组件*名*  =>  组件所属部分  ： 备注

* (home)聊天界面整体 => 显示在主页中  ： 不要在意这个名字
* (myInfo)成员信息 => 在 home 中  ： 下属两个同级组件，分别为 用户列表 和 我的信息
* (Profile)用户列表 ： 获取目前登录的房间的全部用户列表，这里只显示昵称，国家与地区
* (set)我的信息 ：修改我的信息
* (creatSpace)创建房间 => 在home中  ： 主页里的创建房间用的也是这个组件
* (chatSpace)聊天界面 => 在home中  ： 聊天界面，可以分享房间，修改房间信息 ： 房间名不能相同。
* (setRoom)修改房间信息 => 在chatSpace中
* (share)分享房间 => 在chatSpace中  ： 算是一个样子货。点击分享按钮，会alert出房间信息。

#### 界面功能补充

**聊天界面：**

	只支持发送文本，可以加表情。其他内容都无法发送。聊天记录存在vuex中。

	设计稿中的图标，其中一个改为了向下箭头，作用是滑到信息界面最底部。

	当有用户进入时，会有message弹出提醒，因为socket设置问题，这个提心可能会有点频繁。

	这个提醒，由于同步执行，有时可能会显示undefined

**用户列表：**

	每个用户有： 头像面板 和 信息面板 两个。

	头像面板中展示有头像，昵称和加入系统事件；信息只展示国家与地区

**用户信息：**

	头像， 昵称， 电话， 邮箱， 国家， 地区

	都有默认值，可选填。

	***未进行任何验证***

**房间信息：**

  头像， 名称， topic， describe， password

   password就是邀请码，算是公开信息

**修改房间信息：**

  这里做的比较粗糙。要判断是否是群主

	仅对提交修改的按钮做了限制，非群主成员无法点击。

	其他信息未限制，*即可以修改，但没用*

## 一些实现方式

#### 滚动条

用的是vuescroll插件，美化滚动条

#### websocket

用的是 vue-socket.io 。结合vux使用。 挺好用的

#### vux

vux中包含内容：

	当前房间信息， 当前用户信息， 聊天记录， 聊天图标提示闪烁， socket事件接收

**注：**因为vux是在比较后期的时候使用的，这时一些页面已经写完了，导致vuex没有得到完整的应用。

#### token

token存在localStorage中。

原理：在访问网页时，会马上判断是否存在有token，若不存在，会马上发出请求获取token。

## 前后端交互

#### axios

请求拦截器：把token放在请求头中

自动插入跟路劲

#### 跨域

跨域只在开发的时候有用到，

用的是proxy代理。代码在vue.config.js中

#### [接口文档](http://www.mr-lin.site/ChatRoomAPI/)

## 还剩的一些bug

#### 头像上传预览

这个bug出现的莫名奇妙，且短期内找不到办法改

头像上传：可以点击 1.选择文件；2.拖拽上传

出现bug： 拖拽失效，预览失效

情况：是在聊天室中的部分失效，而***在主页的创建房间里，是成功的***。

			当是，主页的创建房间 和 聊天室里的，使用的是同一个组件，同一套代码。

			我就很迷，改了一天没改成，而且是突然失效的。

			功能代码应该没问题，毕竟主页的成功了。哎

#### socket的bug

我socket是在聊天界面的组件中启用的，如果聊天时点击到同级和高一级的组件中（如：创建，查看用户列表 和 主页）就会停止socket；再点进聊天界面就再连接。

就数据变动有些过于频繁

计划把socket在home组件（聊天室的最高组件）中使用，因为数据存在vuex中应该是没问题的。

还未改变。使用时ok的

#### 滚动条的bug

聊天界面，滚动条设置应该要 如果在底部，收到消息，就应该自动滚到底部。

这点有进行判断，但结果失败了，还没改；

聊天记录搜索本来要设置定位的，但发现我用的滚动条组件要求是直接子元素才能定位，但我设置的不是直接子元素，样式改动比较复杂。就改成了显示所有的记录，巨丑。

#### 表情包bug

表情面板显示：

1.当侧边栏没展开时，显示在右下角，和设计稿相同；

2.当侧边栏展开时，显示在左下角。由于我设置的一些样式，如果放在右下角，会被侧边栏遮住。修改起来比较麻烦，就直接搞到右边了


## 一些问题（和bug差不多）

#### 修改信息后的显示问题

> 修改信息后 在显示上3个问题

1. 修改信息结果（成功或失败）提示，做的不完整，有的地方修改了有提示，有的地方没做提示
2. 提示信息的不完整，只有成功和失败两个提示，具体的失败原因没有提示。如：网络问题，验证权限问题等等问题，后端有放回，但我没做区分显示
3. 修改信息成功后 信息显示列表的刷新问题， 有两个情况：（1) 同组件下，信息修改成功，刷新。这也是做的不够完整，有的地方有，有的地方无；    （2）同级组件或不同组件下，如信息显示界面中修改个人信息 与 显示成员列表 为同级组件，同时显示。在修改个人信息后，成员列表中个人信息无法同步刷新；

> 修改办法 （想法，未执行）

1. 提示问题，在回调函数中判断 并 提示 就好；

2. 修改的信息同步问题， 我个人偏向于使用vuex来解决。   使用vuex的好处：

   1. 数据在“根组件”的created中申请一遍就好，不需要在每一个需要的组件中再次请求与储存，节约空间与网络资源；  

   2. 数据在vuex中，调用与更新方便。不需要考虑再次刷新的问题；

> 我为什么没有在这使用到vuex捏？
>
> vuex的学习计划偏后，在学会vuex的时候整个项目的基本框架已经写的差不多了，又因为刚刚才学的vuex，就不是很习惯的去使用，没想到要改多少。
>
> 所以使用了vuex，但没有用充分。

#### 图标下拉列表的出现消失问题

我总共又两处地方使用了 图标 的下拉列表。分别是 聊天室的侧边列表的 选择项 和 设置按钮。

element中的下拉列表样式不符合要求（我也找不到能更改成我需要样子的方法），就自己写了，

问题主要又两个：

1. 丑，自己写的两个，一个是设计稿上有的，就还好。另一个是没有的，就感觉好丑；
2. 出现和消失时机不太对劲。 两个列表。同样的，在设计稿中有的那个，使用起来会比较自然，感觉也是还好。但设置按钮，设置为mouseover图标的时候出现，从列表中mouseout的时候消失，可以使用，就体验感怪怪的。

#### 搜索显示的问题

> 有两处搜索： 聊天信息搜索 和 成员列表搜索

* 聊天信息搜索：

  搜索功能是**后端实现**，要求*至少要3个字符*（这里如果没有3个字符，我**没给提示**）；

  搜索结果是再显示一个列表，包含发送人 和 消息；

  本来的打算是通过聊天信息的id直接滚动条滚动到相应的聊天记录处，但这种实现对我有两个难点限制，一是滚动条要求聊天信息是直接子元素，我搞的不是，要改的话样式要大改；二是搜索结果大于一个的时候，要有滚动到下一条或是上一条的选项，对这个没想法；

  聊天信息搜索列表有bug：点击搜索的时候，空的列表空间直接显示出来了；固定显示结果位置的大小；列表滚动条样式未设置；

  **总之这个的缺点就是丑，样式没设置好**（最后一天想起来要做，我的问题）

* 成员列表搜索

  搜索功能是**前端实现**，只能对成员的姓名（昵称）进行搜索。

  搜索结果是筛选显示，列表中显示全部搜索结果。

  功能略简陋了

#### 退出聊天室问题

emmm，特地的 退出聊天是压根就没写。

在左下角的 设置按钮 有两个选项， 分别是 主页 与 注销。

按照设计， 注销按钮是退出聊天室的选项，主页 就是回到主页（主页可以加入，创建聊天室，选择进入曾加入的聊天室）

现在的情况就是 注销 和 主页 按钮功能全都是 回到主页，没有注销当前聊天室的选项；

#### 注销聊天室

没有写删除聊天室的功能









